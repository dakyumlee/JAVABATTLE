<!DOCTYPE html>
<html lang="ko">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Java Battle Arena - Í∑∏Î¶∞422</title>
   <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
   <style>
   	* {
   		margin: 0;
   		padding: 0;
   		box-sizing: border-box;
   	}

   	body {
   		font-family: "Pretendard Variable", Pretendard, -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
   		background: #0a0a0a;
   		color: #ffffff;
   		overflow-x: hidden;
   	}

   	.container {
   		min-height: 100vh;
   		display: flex;
   		flex-direction: column;
   	}

   	.header {
   		padding: 1.5rem 2rem;
   		backdrop-filter: blur(10px);
   		border-bottom: 1px solid rgba(255, 255, 255, 0.08);
   	}

   	.nav {
   		display: flex;
   		justify-content: space-between;
   		align-items: center;
   		max-width: 1400px;
   		margin: 0 auto;
   	}

   	.logo {
   		display: flex;
   		align-items: center;
   		gap: 0.75rem;
   		font-size: 1.5rem;
   		font-weight: 700;
   		color: #ffffff;
   	}

   	.logo-icon {
   		width: 32px;
   		height: 32px;
   		background: #6366f1;
   		border-radius: 8px;
   		display: flex;
   		align-items: center;
   		justify-content: center;
   		font-size: 1.2rem;
   	}

   	.auth-buttons {
   		display: flex;
   		gap: 1rem;
   		align-items: center;
   	}

   	.btn {
   		padding: 0.75rem 1.5rem;
   		border-radius: 8px;
   		font-weight: 500;
   		cursor: pointer;
   		transition: all 0.2s ease;
   		text-decoration: none;
   		border: none;
   		font-size: 0.9rem;
   		font-family: inherit;
   	}

   	.btn-outline {
   		background: transparent;
   		border: 1px solid rgba(255, 255, 255, 0.2);
   		color: #ffffff;
   	}

   	.btn-outline:hover {
   		background: rgba(255, 255, 255, 0.05);
   		border-color: rgba(255, 255, 255, 0.3);
   	}

   	.btn-primary {
   		background: #6366f1;
   		color: #ffffff;
   	}

   	.btn-primary:hover {
   		background: #5856eb;
   	}

   	.main {
   		flex: 1;
   		padding: 2rem;
   		max-width: 1400px;
   		margin: 0 auto;
   		width: 100%;
   	}

   	.hero {
   		text-align: center;
   		margin-bottom: 4rem;
   	}

   	.hero h1 {
   		font-size: 3.5rem;
   		font-weight: 800;
   		margin-bottom: 1rem;
   		letter-spacing: -0.02em;
   		line-height: 1.1;
   	}

   	.hero-subtitle {
   		font-size: 1.25rem;
   		color: #9ca3af;
   		margin-bottom: 2rem;
   		line-height: 1.6;
   	}

   	.academy-grid {
   		display: grid;
   		grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
   		gap: 2rem;
   		margin-bottom: 3rem;
   	}

   	.academy-card {
   		background: linear-gradient(135deg, #1a1a2e, #16213e);
   		border: 1px solid rgba(255, 255, 255, 0.1);
   		border-radius: 16px;
   		padding: 2rem;
   		text-align: center;
   		transition: all 0.3s ease;
   		cursor: pointer;
   	}

   	.academy-card:hover {
   		transform: translateY(-5px);
   		border-color: rgba(99, 102, 241, 0.5);
   		box-shadow: 0 10px 30px rgba(99, 102, 241, 0.2);
   	}

   	.card-icon {
   		font-size: 3rem;
   		margin-bottom: 1rem;
   		display: block;
   	}

   	.card-title {
   		font-size: 1.5rem;
   		font-weight: 600;
   		margin-bottom: 1rem;
   		color: #ffffff;
   	}

   	.card-description {
   		color: #9ca3af;
   		line-height: 1.6;
   		margin-bottom: 1.5rem;
   	}

   	.card-badge {
   		display: inline-block;
   		padding: 0.5rem 1rem;
   		background: rgba(99, 102, 241, 0.2);
   		color: #a5b4fc;
   		border-radius: 20px;
   		font-size: 0.8rem;
   		font-weight: 500;
   	}

   	.battle-section {
   		background: linear-gradient(135deg, #1a2332, #2d1b69);
   		border-radius: 16px;
   		padding: 2rem;
   		text-align: center;
   		margin-bottom: 2rem;
   	}

   	.battle-title {
   		font-size: 2rem;
   		font-weight: 700;
   		margin-bottom: 1rem;
   	}

   	.battle-subtitle {
   		color: #9ca3af;
   		margin-bottom: 2rem;
   	}

   	.battle-options {
   		display: grid;
   		grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
   		gap: 1rem;
   	}

   	.battle-btn {
   		background: linear-gradient(135deg, #6366f1, #8b5cf6);
   		color: white;
   		padding: 1rem 1.5rem;
   		border-radius: 12px;
   		border: none;
   		cursor: pointer;
   		font-weight: 600;
   		font-size: 1rem;
   		transition: all 0.3s ease;
   	}

   	.battle-btn:hover {
   		transform: translateY(-2px);
   		box-shadow: 0 8px 20px rgba(99, 102, 241, 0.4);
   	}

   	.battle-btn.secondary {
   		background: linear-gradient(135deg, #374151, #4b5563);
   	}

   	.user-info {
   		display: none;
   		align-items: center;
   		gap: 1rem;
   	}

   	.user-info.active {
   		display: flex;
   	}

   	.user-avatar {
   		width: 32px;
   		height: 32px;
   		background: #6366f1;
   		border-radius: 50%;
   		display: flex;
   		align-items: center;
   		justify-content: center;
   		font-weight: 600;
   	}

   	.role-badge {
   		padding: 0.3rem 0.8rem;
   		border-radius: 20px;
   		font-size: 0.7rem;
   		font-weight: 600;
   		margin-left: 0.5rem;
   	}

   	.role-student { background: rgba(99, 102, 241, 0.2); color: #a5b4fc; }
   	.role-teacher { background: rgba(245, 124, 0, 0.2); color: #ffa726; }
   	.role-admin { background: rgba(244, 67, 54, 0.2); color: #ef5350; }

   	.admin-section {
   		background: #2a1f1f;
   		border: 2px solid #e53e3e;
   		border-radius: 16px;
   		padding: 2rem;
   		margin-bottom: 2rem;
   		display: none;
   	}

   	.admin-section.show {
   		display: block;
   	}

   	.admin-title {
   		color: #fc8181;
   		font-size: 1.5rem;
   		font-weight: 700;
   		margin-bottom: 1rem;
   		text-align: center;
   	}

   	.admin-actions {
   		display: grid;
   		grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
   		gap: 1rem;
   	}

   	.admin-section .battle-btn {
   		background: #e53e3e;
   	}

   	.admin-section .battle-btn:hover {
   		background: #c53030;
   		box-shadow: 0 8px 20px rgba(229, 62, 62, 0.4);
   	}

   	.admin-section .battle-btn.secondary {
   		background: #742a2a;
   	}

   	.admin-section .battle-btn.secondary:hover {
   		background: #652b2b;
   	}

   	.teacher-section {
   		background: #2d2416;
   		border: 2px solid #ed8936;
   		border-radius: 16px;
   		padding: 2rem;
   		margin-bottom: 2rem;
   		display: none;
   	}

   	.teacher-section.show {
   		display: block;
   	}

   	.teacher-title {
   		color: #fbb867;
   		font-size: 1.5rem;
   		font-weight: 700;
   		margin-bottom: 1rem;
   		text-align: center;
   	}

   	.teacher-section .battle-btn {
   		background: #ed8936;
   	}

   	.teacher-section .battle-btn:hover {
   		background: #dd7724;
   		box-shadow: 0 8px 20px rgba(237, 137, 54, 0.4);
   	}

   	.teacher-section .battle-btn.secondary {
   		background: #975a16;
   	}

   	.teacher-section .battle-btn.secondary:hover {
   		background: #804d14;
   	}

   	.auth-modal {
   		position: fixed;
   		top: 0;
   		left: 0;
   		right: 0;
   		bottom: 0;
   		background: rgba(0, 0, 0, 0.8);
   		display: flex;
   		align-items: center;
   		justify-content: center;
   		z-index: 1000;
   		opacity: 0;
   		visibility: hidden;
   		transition: all 0.3s ease;
   	}

   	.auth-modal.active {
   		opacity: 1;
   		visibility: visible;
   	}

   	.modal-content {
   		background: #111111;
   		border: 1px solid rgba(255, 255, 255, 0.1);
   		border-radius: 16px;
   		padding: 2rem;
   		width: 90%;
   		max-width: 400px;
   		transform: scale(0.9);
   		transition: transform 0.3s ease;
   	}

   	.auth-modal.active .modal-content {
   		transform: scale(1);
   	}

   	.modal-header {
   		text-align: center;
   		margin-bottom: 2rem;
   	}

   	.modal-title {
   		font-size: 1.5rem;
   		font-weight: 600;
   		margin-bottom: 0.5rem;
   	}

   	.form-group {
   		margin-bottom: 1.5rem;
   	}

   	.form-label {
   		display: block;
   		margin-bottom: 0.5rem;
   		font-weight: 500;
   		color: #e5e5e5;
   	}

   	.form-input {
   		width: 100%;
   		padding: 0.75rem;
   		background: rgba(255, 255, 255, 0.05);
   		border: 1px solid rgba(255, 255, 255, 0.1);
   		border-radius: 8px;
   		color: #ffffff;
   		font-size: 1rem;
   		font-family: inherit;
   	}

   	.form-input:focus {
   		outline: none;
   		border-color: #6366f1;
   		background: rgba(255, 255, 255, 0.08);
   	}

   	.btn-full {
   		width: 100%;
   		margin-bottom: 1rem;
   	}

   	.modal-switch {
   		text-align: center;
   		color: #9ca3af;
   	}

   	.modal-switch a {
   		color: #6366f1;
   		text-decoration: none;
   	}

   	.modal-switch a:hover {
   		text-decoration: underline;
   	}

   	.close-modal {
   		position: absolute;
   		top: 1rem;
   		right: 1rem;
   		background: none;
   		border: none;
   		color: #9ca3af;
   		font-size: 1.5rem;
   		cursor: pointer;
   		padding: 0.5rem;
   	}

   	.close-modal:hover {
   		color: #ffffff;
   	}

   	@media (max-width: 768px) {
   		.hero h1 {
   			font-size: 2.5rem;
   		}
   		
   		.academy-grid {
   			grid-template-columns: 1fr;
   		}
   	}
   </style>
</head>
<body>
   <div class="container">
   	<header class="header">
   		<nav class="nav">
   			<div class="logo">
   				<div class="logo-icon">üìö</div>
   				<span>Java Battle Arena</span>
   			</div>
   			<div class="auth-buttons" id="authButtons">
   				<button class="btn btn-outline" onclick="openModal('login')">Î°úÍ∑∏Ïù∏</button>
   				<button class="btn btn-primary" onclick="openModal('register')">ÌöåÏõêÍ∞ÄÏûÖ</button>
   			</div>
   			<div class="user-info" id="userInfo">
   				<div class="user-avatar" id="userAvatar">J</div>
   				<span id="userNickname" class="user-name">ÏÇ¨Ïö©Ïûê</span>
   				<span class="role-badge" id="userRole">STUDENT</span>
   				<button class="btn btn-outline" onclick="logout()">Î°úÍ∑∏ÏïÑÏõÉ</button>
   			</div>
   		</nav>
   	</header>

   	<main class="main">
   		<div class="hero">
   			<h1>Java ÌïôÏäµ ÌîåÎû´Ìèº</h1>
   			<p class="hero-subtitle">
   				Ïã§ÏäµÍ≥º Ïù¥Î°†ÏùÑ Ìï®Íªò! ÎßûÏ∂§Ìòï Java ÌïôÏäµ ÏãúÏä§ÌÖú
   			</p>
   		</div>

   		<div class="teacher-section" id="teacherSection">
   			<h2 class="teacher-title">üë®‚Äçüè´ Í∞ïÏÇ¨ Ï†ÑÏö©</h2>
   			<div class="battle-options">
   				<button class="battle-btn" onclick="goToTeacherMonitor()">
   					üìä Ïã§ÏãúÍ∞Ñ Î™®ÎãàÌÑ∞ÎßÅ
   				</button>
   				<button class="battle-btn" onclick="goToTeacherMaterials()">
   					üìö ÌïôÏäµ ÏûêÎ£å Í¥ÄÎ¶¨
   				</button>
   				<button class="battle-btn secondary" onclick="goToTeacherStats()">
   					üìà ÌïôÏäµ ÌÜµÍ≥Ñ
   				</button>
   			</div>
   		</div>

   		<div class="admin-section" id="adminSection">
   			<h2 class="admin-title">‚öôÔ∏è Í¥ÄÎ¶¨Ïûê Ï†ÑÏö©</h2>
   			<div class="admin-actions">
   				<button class="battle-btn" onclick="promoteTeacher()">
   					üë®‚Äçüè´ Í∞ïÏÇ¨ Í∂åÌïú Î∂ÄÏó¨
   				</button>
   				<button class="battle-btn" onclick="createTeacherAccount()">
   					‚ûï Í∞ïÏÇ¨ Í≥ÑÏ†ï ÏÉùÏÑ±
   				</button>
   				<button class="battle-btn" onclick="manageUsers()">
   					üë• ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨
   				</button>
   				<button class="battle-btn secondary" onclick="systemSettings()">
   					‚öôÔ∏è ÏãúÏä§ÌÖú ÏÑ§Ï†ï
   				</button>
   			</div>
   		</div>

   		<div class="academy-grid">
   			<div class="academy-card" onclick="goToStudy()">
   				<span class="card-icon">üìñ</span>
   				<h3 class="card-title">Ïò§ÎäòÏùò ÌïôÏäµ</h3>
   				<p class="card-description">
   					Í∞ïÏÇ¨ÎãòÏù¥ Ï§ÄÎπÑÌïú Ïò§ÎäòÏùò ÏàòÏóÖ ÎÇ¥Ïö©Í≥º<br>
   					Î≥µÏäµ Î¨∏Ï†úÎ•º ÌôïÏù∏ÌïòÏÑ∏Ïöî
   				</p>
   				<span class="card-badge" id="progressBadge">ÏßÑÎèÑÏú® 0%</span>
   			</div>

   			<div class="academy-card" onclick="goToAI()">
   				<span class="card-icon">ü§ñ</span>
   				<h3 class="card-title">AI ÌäúÌÑ∞</h3>
   				<p class="card-description">
   					Java Í¥ÄÎ†® ÏßàÎ¨∏ÏùÑ AIÏóêÍ≤å Î¨ºÏñ¥Î≥¥Í≥†<br>
   					Ï¶âÏãú ÎãµÎ≥ÄÏùÑ Î∞õÏïÑÎ≥¥ÏÑ∏Ïöî
   				</p>
   				<span class="card-badge">24ÏãúÍ∞Ñ Ïù¥Ïö©Í∞ÄÎä•</span>
   			</div>

   			<div class="academy-card" onclick="goToPractice()">
   				<span class="card-icon">üíª</span>
   				<h3 class="card-title">ÏΩîÎî© Ïó∞Ïäµ</h3>
   				<p class="card-description">
   					Í∏∞Ï¥àÎ∂ÄÌÑ∞ Í≥†Í∏âÍπåÏßÄ<br>
   					Îã®Í≥ÑÎ≥Ñ ÏΩîÎî© Î¨∏Ï†ú Ìï¥Í≤∞
   				</p>
   				<span class="card-badge" id="problemsBadge">ÏôÑÎ£å: 0/150 Î¨∏Ï†ú</span>
   			</div>

   			<div class="academy-card" onclick="goToReview()">
   				<span class="card-icon">üìù</span>
   				<h3 class="card-title">Î≥µÏäµ ÎÖ∏Ìä∏</h3>
   				<p class="card-description">
   					ÏàòÏóÖ ÎÇ¥Ïö© Ï†ïÎ¶¨ÏôÄ<br>
   					Í∞úÏù∏ ÌïôÏäµ Í∏∞Î°ù Í¥ÄÎ¶¨
   				</p>
   				<span class="card-badge" id="notesBadge">ÎÖ∏Ìä∏: 0Í∞ú</span>
   			</div>
   		</div>

   		<div class="battle-section">
   			<h2 class="battle-title">‚öîÔ∏è ÏΩîÎî© Î∞∞ÌãÄ</h2>
   			<p class="battle-subtitle">ÎèôÎ£åÎì§Í≥º Ïã§Î†•ÏùÑ Í≤®Î§ÑÎ≥¥ÏÑ∏Ïöî!</p>
   			
   			<div class="battle-options">
   				<button class="battle-btn" onclick="startSoloBattle()">
   					üéØ ÌòºÏûê Ïó∞Ïäµ
   				</button>
   				<button class="battle-btn" onclick="createRoom()">
   					üè† Î∞© ÎßåÎì§Í∏∞
   				</button>
   				<button class="battle-btn" onclick="joinRandomBattle()">
   					‚ö° ÎûúÎç§ Îß§Ïπ≠
   				</button>
   				<button class="battle-btn" onclick="joinRoomWithCode()">
   					üîë Ï¥àÎåÄÏΩîÎìú ÏûÖÎ†•
   				</button>
   				<button class="battle-btn secondary" onclick="goToRanking()">
   					üèÜ Îû≠ÌÇπ Î≥¥Í∏∞
   				</button>
   			</div>
   		</div>
   	</main>
   </div>

   <div class="auth-modal" id="authModal">
   	<div class="modal-content">
   		<button class="close-modal" onclick="closeModal()">√ó</button>
   		<div class="modal-header">
   			<h2 class="modal-title" id="modalTitle">Î°úÍ∑∏Ïù∏</h2>
   			<p id="modalSubtitle">Í≥ÑÏ†ïÏóê Î°úÍ∑∏Ïù∏ÌïòÏÑ∏Ïöî</p>
   		</div>
   		
   		<form id="authForm">
   			<div class="form-group">
   				<label class="form-label" for="email">Ïù¥Î©îÏùº</label>
   				<input type="email" id="email" class="form-input" placeholder="your@email.com" required>
   			</div>
   			
   			<div class="form-group" id="nicknameGroup" style="display: none;">
   				<label class="form-label" for="nickname">ÎãâÎÑ§ÏûÑ</label>
   				<input type="text" id="nickname" class="form-input" placeholder="ÎãâÎÑ§ÏûÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
   			</div>
   			
   			<div class="form-group">
   				<label class="form-label" for="password">ÎπÑÎ∞ÄÎ≤àÌò∏</label>
   				<input type="password" id="password" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
   			</div>
   			
   			<div class="form-group" id="confirmPasswordGroup" style="display: none;">
   				<label class="form-label" for="confirmPassword">ÎπÑÎ∞ÄÎ≤àÌò∏ ÌôïÏù∏</label>
   				<input type="password" id="confirmPassword" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
   			</div>
   			
   			<button type="submit" class="btn btn-primary btn-full">
   				<span id="submitText">Î°úÍ∑∏Ïù∏</span>
   			</button>
   		</form>
   		
   		<p class="modal-switch">
   			<span id="switchText">Í≥ÑÏ†ïÏù¥ ÏóÜÏúºÏã†Í∞ÄÏöî?</span>
   			<a href="#" onclick="switchMode()" id="switchLink">ÌöåÏõêÍ∞ÄÏûÖ</a>
   		</p>
   	</div>
   </div>

	<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
	<script src="/js/student-activity.js"></script>
   <script>
   	let isLoginMode = true;
   	let currentUser = null;
   	let userId = null;
   	let authToken = localStorage.getItem('authToken') || sessionStorage.getItem('authToken');
   	let currentUserRole = 'STUDENT';
   	let battleStompClient = null;

   	document.addEventListener('DOMContentLoaded', function() {
   		if (authToken) {
   			checkAuthStatus();
   		}
   	});

   	function requireAuth(callback) {
   		if (!authToken || !userId) {
   			alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌïú ÏÑúÎπÑÏä§ÏûÖÎãàÎã§.');
   			openModal('login');
   			return false;
   		}
   		callback();
   		return true;
   	}

   	function startSoloBattle() {
   		requireAuth(() => {
   			window.location.href = '/battle?mode=solo';
   		});
   	}

   	function createRoom() {
   		requireAuth(() => {
   			const roomName = prompt('Î∞© Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî:');
   			if (roomName) {
   				window.location.href = `/battle?mode=create&room=${encodeURIComponent(roomName)}`;
   			}
   		});
   	}

   	function joinRandomBattle() {
   		requireAuth(() => {
   			window.location.href = '/battle?mode=random';
   		});
   	}

   	function joinRoomWithCode() {
   		requireAuth(() => {
   			const inviteCode = prompt('Ï¥àÎåÄÏΩîÎìúÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî:');
   			if (inviteCode) {
   				window.location.href = `/battle?mode=join&code=${encodeURIComponent(inviteCode.toUpperCase())}`;
   			}
   		});
   	}

   	function connectToBattleServer() {
   		const token = localStorage.getItem('authToken') || sessionStorage.getItem('authToken');
   		if (!token) return;

   		const socket = new SockJS('/ws');
   		battleStompClient = Stomp.over(socket);
   		
   		battleStompClient.connect(
   			{'Authorization': `Bearer ${token}`}, 
   			function(frame) {
   				console.log('Î∞∞ÌãÄ ÏÑúÎ≤Ñ Ïó∞Í≤∞ ÏÑ±Í≥µ');
   				
   				battleStompClient.subscribe('/user/queue/battle', function(message) {
   					const data = JSON.parse(message.body);
   					handleBattleMessage(data);
   				});
   			},
   			function(error) {
   				console.error('Î∞∞ÌãÄ ÏÑúÎ≤Ñ Ïó∞Í≤∞ Ïã§Ìå®:', error);
   			}
   		);
   	}

   	function handleBattleMessage(data) {
   		switch(data.type) {
   			case 'ROOM_FOUND':
   				window.location.href = `/battle-room?roomId=${data.roomId}`;
   				break;
   			case 'ROOM_NOT_FOUND':
   				alert('Ìï¥Îãπ Ï¥àÎåÄÏΩîÎìúÏùò Î∞©ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
   				break;
   			case 'ROOM_FULL':
   				alert('Î∞©Ïù¥ Í∞ÄÎìù Ï∞ºÏäµÎãàÎã§.');
   				break;
   			case 'GAME_START':
   				window.location.href = `/battle-room?roomId=${data.roomId}`;
   				break;
   		}
   	}

   	function goToStudy() {
   		requireAuth(() => {
   			window.location.href = '/study';
   		});
   	}

   	function goToAI() {
   		requireAuth(() => {
   			window.location.href = '/ai-tutor';
   		});
   	}

   	function goToPractice() {
   		requireAuth(() => {
   			window.location.href = '/practice';
   		});
   	}

   	function goToReview() {
   		requireAuth(() => {
   			window.location.href = '/review';
   		});
   	}

   	function goToTeacherMonitor() {
   		if (currentUserRole === 'TEACHER' || currentUserRole === 'ADMIN') {
   			window.location.href = '/teacher';
   		} else {
   			alert('Í∞ïÏÇ¨ Í∂åÌïúÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
   		}
   	}

   	function goToTeacherMaterials() {
   		if (currentUserRole === 'TEACHER' || currentUserRole === 'ADMIN') {
   			window.location.href = '/teacher-materials';
   		} else {
   			alert('Í∞ïÏÇ¨ Í∂åÌïúÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
   		}
   	}

   	function goToTeacherStats() {
   		if (currentUserRole === 'TEACHER' || currentUserRole === 'ADMIN') {
   			window.location.href = '/statistics';
   		} else {
   			alert('Í∞ïÏÇ¨ Í∂åÌïúÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
   		}
   	}

   	function promoteTeacher() {
   		if (currentUserRole !== 'ADMIN') {
   			alert('Í¥ÄÎ¶¨Ïûê Í∂åÌïúÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
   			return;
   		}
   		const email = prompt('Í∞ïÏÇ¨Î°ú ÏäπÍ∏âÌï† ÏÇ¨Ïö©ÏûêÏùò Ïù¥Î©îÏùºÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî:');
   		if (email) {
   			fetch('/api/admin/promote-teacher', {
   				method: 'POST',
   				headers: {
   					'Content-Type': 'application/json',
   					'Authorization': 'Bearer ' + authToken
   				},
   				body: JSON.stringify({ email: email })
   			})
   			.then(response => response.text())
   			.then(message => alert(message))
   			.catch(() => alert('ÏäπÍ∏â Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.'));
   		}
   	}

   	function createTeacherAccount() {
   		if (currentUserRole !== 'ADMIN') {
   			alert('Í¥ÄÎ¶¨Ïûê Í∂åÌïúÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
   			return;
   		}
   		const email = prompt('Í∞ïÏÇ¨ Ïù¥Î©îÏùº:');
   		const password = prompt('ÎπÑÎ∞ÄÎ≤àÌò∏:');
   		const nickname = prompt('ÎãâÎÑ§ÏûÑ:');
   		
   		if (email && password && nickname) {
   			fetch('/api/admin/create-teacher', {
   				method: 'POST',
   				headers: {
   					'Content-Type': 'application/json',
   					'Authorization': 'Bearer ' + authToken
   				},
   				body: JSON.stringify({ email, password, nickname })
   			})
   			.then(response => response.text())
   			.then(message => alert(message))
   			.catch(() => alert('Í≥ÑÏ†ï ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.'));
   		}
   	}

   	function manageUsers() {
   		if (currentUserRole === 'ADMIN') {
   			window.location.href = '/admin/users';
   		} else {
   			alert('Í¥ÄÎ¶¨Ïûê Í∂åÌïúÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
   		}
   	}

   	function systemSettings() {
   		if (currentUserRole === 'ADMIN') {
   			window.location.href = '/admin/settings';
   		} else {
   			alert('Í¥ÄÎ¶¨Ïûê Í∂åÌïúÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
   		}
   	}

   	function goToRanking() {
   		window.location.href = '/ranking';
   	}

   	function openModal(mode) {
   		const modal = document.getElementById('authModal');
   		modal.classList.add('active');
   		
   		if (mode === 'register') {
   			switchToRegister();
   		} else {
   			switchToLogin();
   		}
   	}

   	function closeModal() {
   		const modal = document.getElementById('authModal');
   		modal.classList.remove('active');
   		clearForm();
   	}

   	function switchMode() {
   		if (isLoginMode) {
   			switchToRegister();
   		} else {
   			switchToLogin();
   		}
   	}

   	function switchToLogin() {
   		isLoginMode = true;
   		document.getElementById('modalTitle').textContent = 'Î°úÍ∑∏Ïù∏';
   		document.getElementById('modalSubtitle').textContent = 'Í≥ÑÏ†ïÏóê Î°úÍ∑∏Ïù∏ÌïòÏÑ∏Ïöî';
   		document.getElementById('submitText').textContent = 'Î°úÍ∑∏Ïù∏';
   		document.getElementById('switchText').textContent = 'Í≥ÑÏ†ïÏù¥ ÏóÜÏúºÏã†Í∞ÄÏöî?';
   		document.getElementById('switchLink').textContent = 'ÌöåÏõêÍ∞ÄÏûÖ';
   		document.getElementById('nicknameGroup').style.display = 'none';
   		document.getElementById('confirmPasswordGroup').style.display = 'none';
   	}

   	function switchToRegister() {
   		isLoginMode = false;
   		document.getElementById('modalTitle').textContent = 'ÌöåÏõêÍ∞ÄÏûÖ';
   		document.getElementById('modalSubtitle').textContent = 'ÏÉà Í≥ÑÏ†ïÏùÑ ÎßåÎìúÏÑ∏Ïöî';
   		document.getElementById('submitText').textContent = 'ÌöåÏõêÍ∞ÄÏûÖ';
   		document.getElementById('switchText').textContent = 'Ïù¥ÎØ∏ Í≥ÑÏ†ïÏù¥ ÏûàÏúºÏã†Í∞ÄÏöî?';
   		document.getElementById('switchLink').textContent = 'Î°úÍ∑∏Ïù∏';
   		document.getElementById('nicknameGroup').style.display = 'block';
   		document.getElementById('confirmPasswordGroup').style.display = 'block';
   	}

   	function clearForm() {
   		document.getElementById('email').value = '';
   		document.getElementById('password').value = '';
   		document.getElementById('nickname').value = '';
   		document.getElementById('confirmPassword').value = '';
   	}

   	async function checkAuthStatus() {
   		try {
   			const response = await fetch('/api/auth/profile', {
   				headers: {
   					'Authorization': 'Bearer ' + authToken,
   					'Content-Type': 'application/json'
   				}
   			});

   			if (response.ok) {
   				const user = await response.json();
   				currentUser = user;
   				userId = user.id;
   				window.userId = userId;
   				window.currentUser = currentUser;
   				showUserInfo(user);
   			} else {
   				localStorage.removeItem('authToken');
   				sessionStorage.removeItem('authToken');
   				authToken = null;
   				userId = null;
   				currentUser = null;
   			}
   		} catch (error) {
   			console.error('Auth check failed:', error);
   			localStorage.removeItem('authToken');
   			sessionStorage.removeItem('authToken');
   			authToken = null;
   			userId = null;
   			currentUser = null;
   		}
   	}

   	function showUserInfo(user) {
   		document.getElementById('authButtons').style.display = 'none';
   		document.getElementById('userInfo').classList.add('active');
   		document.getElementById('userNickname').textContent = user.nickname || user.email;
   		document.getElementById('userAvatar').textContent = (user.nickname || user.email).charAt(0).toUpperCase();
   		
   		currentUserRole = user.role || 'STUDENT';
   		const roleElement = document.getElementById('userRole');
   		roleElement.textContent = currentUserRole;
   		roleElement.className = `role-badge role-${currentUserRole.toLowerCase()}`;
   		
   		if (currentUserRole === 'TEACHER' || currentUserRole === 'ADMIN') {
   			document.getElementById('teacherSection').classList.add('show');
   		}
   		
   		if (currentUserRole === 'ADMIN') {
   			document.getElementById('adminSection').classList.add('show');
   		}
   		
   		connectToBattleServer();
   		loadDashboardData();
   	}

   	async function loadDashboardData() {
   		try {
   			const response = await fetch('/api/statistics/overview', {
   				headers: {
   					'Authorization': 'Bearer ' + authToken,
   					'Content-Type': 'application/json'
   				}
   			});
   			
   			if (response.ok) {
   				const data = await response.json();
   				updateDashboardUI(data);
   			}
   		} catch (error) {
   			console.error('Dashboard data loading failed:', error);
   		}
   	}

   	function updateDashboardUI(data) {
   		if (data) {
   			document.getElementById('progressBadge').textContent = `ÏßÑÎèÑÏú® ${data.progressPercentage || 0}%`;
   			document.getElementById('problemsBadge').textContent = `ÏôÑÎ£å: ${data.completedProblems || 0}/${data.totalProblems || 150} Î¨∏Ï†ú`;
   			document.getElementById('notesBadge').textContent = `ÎÖ∏Ìä∏: ${data.totalNotes || 0}Í∞ú`;
   		}
   	}

   	function logout() {
   		localStorage.removeItem('authToken');
   		sessionStorage.removeItem('authToken');
   		authToken = null;
   		userId = null;
   		currentUser = null;
   		currentUserRole = 'STUDENT';
   		
   		delete window.userId;
   		delete window.currentUser;
   		
   		document.getElementById('authButtons').style.display = 'flex';
   		document.getElementById('userInfo').classList.remove('active');
   		document.getElementById('teacherSection').classList.remove('show');
   		document.getElementById('adminSection').classList.remove('show');
   		
   		if (battleStompClient && battleStompClient.connected) {
   			battleStompClient.disconnect();
   		}
   		
   		document.getElementById('progressBadge').textContent = 'ÏßÑÎèÑÏú® 0%';
   		document.getElementById('problemsBadge').textContent = 'ÏôÑÎ£å: 0/150 Î¨∏Ï†ú';
   		document.getElementById('notesBadge').textContent = 'ÎÖ∏Ìä∏: 0Í∞ú';
   	}

   	document.getElementById('authForm').addEventListener('submit', async function(e) {
   		e.preventDefault();
   		
   		const email = document.getElementById('email').value;
   		const password = document.getElementById('password').value;
   		const nickname = document.getElementById('nickname').value;
   		const confirmPassword = document.getElementById('confirmPassword').value;
   		
   		if (!isLoginMode) {
   			if (password !== confirmPassword) {
   				alert('ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÏùºÏπòÌïòÏßÄ ÏïäÏäµÎãàÎã§!');
   				return;
   			}
   			if (!nickname.trim()) {
   				alert('ÎãâÎÑ§ÏûÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!');
   				return;
   			}
   		}
   		
   		const url = isLoginMode ? '/api/auth/login' : '/api/auth/register';
   		const body = isLoginMode ? 
   			{ email, password } : 
   			{ email, password, nickname };
   		
   		console.log('ÏöîÏ≤≠ Ï†ÑÏÜ°:', { url, body, isLoginMode });
   		
   		try {
   			const response = await fetch(url, {
   				method: 'POST',
   				headers: {
   					'Content-Type': 'application/json'
   				},
   				body: JSON.stringify(body)
   			});
   			
   			const data = await response.json();
   			console.log('ÏÑúÎ≤Ñ ÏùëÎãµ:', data);
   			
   			if (response.ok && (data.status === 'success' || data.success)) {
   				if (isLoginMode && data.token) {
   					authToken = data.token;
   					localStorage.setItem('authToken', authToken);
   					
   					currentUser = {
   						id: data.userId || data.id,
   						email: data.email,
   						nickname: data.nickname || data.email,
   						role: data.role || 'STUDENT'
   					};
   					
   					userId = currentUser.id;
   					window.userId = userId;
   					window.currentUser = currentUser;
   					
   					showUserInfo(currentUser);
   					closeModal();
   					alert(`ÌôòÏòÅÌï©ÎãàÎã§, ${currentUser.nickname}Îãò!`);
   					
   					if (currentUser.role === 'TEACHER') {
   						window.location.href = '/teacher';
   					} else {
   						window.location.href = '/student';
   					}
   				} else if (!isLoginMode) {
   					alert(data.message || 'ÌöåÏõêÍ∞ÄÏûÖÏù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§.');
   					switchToLogin();
   					clearForm();
   				}
   			} else {
   				alert(data.message || 'Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
   			}
   			
   		} catch (error) {
   			console.error('Request failed:', error);
   			alert('ÏÑúÎ≤ÑÏôÄ ÌÜµÏã† Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
   		}
   	});

   	window.addEventListener('click', function(e) {
   		const modal = document.getElementById('authModal');
   		if (e.target === modal) {
   			closeModal();
   		}
   	});
   </script>
</body>
</html>