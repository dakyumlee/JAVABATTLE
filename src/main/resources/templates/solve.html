<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î¨∏Ï†ú ÌíÄÏù¥ - Java Battle Arena</title>
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Pretendard', sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .header {
            background: #1a1a1a;
            padding: 1rem 2rem;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .back-btn {
            background: #6c757d;
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            text-decoration: none;
        }
        
        .back-btn:hover { background: #5a6268; }
        
        .problem-title {
            color: #3498db;
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .header-right {
            display: flex;
            gap: 1rem;
        }
        
        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .btn-hint {
            background: #8e44ad;
            color: white;
        }
        
        .btn-hint:hover { background: #7d3c98; }
        
        .btn-run {
            background: #f39c12;
            color: white;
        }
        
        .btn-run:hover { background: #e67e22; }
        
        .btn-submit {
            background: #27ae60;
            color: white;
        }
        
        .btn-submit:hover { background: #229954; }
        
        .main-container {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1px;
            background: #333;
            overflow: hidden;
        }
        
        .left-panel, .right-panel {
            background: #0a0a0a;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .panel-header {
            background: #1a1a1a;
            padding: 1rem;
            border-bottom: 1px solid #333;
            font-weight: 600;
            color: #3498db;
        }
        
        .problem-content {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            line-height: 1.6;
        }
        
        .problem-description {
            margin-bottom: 1.5rem;
            color: #e0e0e0;
            white-space: pre-line;
        }
        
        .sample-section {
            margin-bottom: 1.5rem;
        }
        
        .sample-title {
            font-weight: 600;
            color: #3498db;
            margin-bottom: 0.5rem;
        }
        
        .sample-content {
            background: #1a1a1a;
            padding: 1rem;
            border-radius: 6px;
            border-left: 4px solid #3498db;
            font-family: 'Consolas', 'Monaco', monospace;
            white-space: pre-wrap;
            color: #e0e0e0;
        }
        
        .code-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        #editor-container {
            flex: 1;
            min-height: 0;
        }
        
        .output-container {
            background: #1a1a1a;
            border-top: 1px solid #333;
            height: 150px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            margin: 1rem 0;
        }
        
        .output-header {
            padding: 0.75rem 1rem;
            background: #2d2d2d;
            font-weight: 600;
            color: #f39c12;
            font-size: 0.9rem;
        }
        
        .output-content {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            color: #e0e0e0;
            background: #0f0f0f;
            font-size: 0.9rem;
        }
        
        .loading { color: #f39c12; }
        .success { color: #27ae60; }
        .error { color: #e74c3c; }
        
        .ai-feedback-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
            color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            max-height: 400px;
            overflow-y: auto;
        }

        .ai-feedback-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .score-display {
            background: rgba(255,255,255,0.2);
            border-radius: 20px;
            padding: 0.5rem 1rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .creative-badge {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
        }

        .feedback-section {
            margin-bottom: 1rem;
        }

        .feedback-section-title {
            font-weight: 600; 
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .feedback-content {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 1rem;
            backdrop-filter: blur(10px);
            line-height: 1.5;
        }

        .strengths-list, .improvements-list {
            list-style: none;
            padding: 0;
        }

        .strengths-list li {
            padding: 0.5rem 0;
            position: relative;
            padding-left: 1.5rem;
        }

        .strengths-list li::before {
            content: "‚úÖ";
            position: absolute;
            left: 0;
        }

        .improvements-list li {
            padding: 0.5rem 0;
            position: relative;
            padding-left: 1.5rem;
        }

        .improvements-list li::before {
            content: "üí°";
            position: absolute;
            left: 0;
        }

        .loading-ai {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 2rem;
            background: #1a1a1a;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #333;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .hint-level {
            background: #2d2d2d;
            color: #8e44ad;
            font-size: 0.8rem;
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
            margin-left: 0.5rem;
        }

        .score-high { background: linear-gradient(135deg, #00b894 0%, #00cec9 100%); }
        .score-medium { background: linear-gradient(135deg, #fdcb6e 0%, #f39c12 100%); color: #333; }
        .score-low { background: linear-gradient(135deg, #e17055 0%, #d63031 100%); }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-left">
            <a href="/practice" class="back-btn">‚Üê Îí§Î°ú</a>
            <h1 class="problem-title" id="problemTitle">Î¨∏Ï†úÎ•º Î∂àÎü¨Ïò§Îäî Ï§ë...</h1>
        </div>
        <div class="header-right">
            <button class="btn btn-hint" onclick="showHint()">
                ÌûåÌä∏ <span class="hint-level" id="hintLevel">0/3</span>
            </button>
            <button class="btn btn-run" onclick="runCode()">Ïã§Ìñâ</button>
            <button class="btn btn-submit" onclick="submitCode()">AI ÌèâÍ∞Ä</button>
        </div>
    </div>

    <div class="main-container">
        <div class="left-panel">
            <div class="panel-header">Î¨∏Ï†ú</div>
            <div class="problem-content">
                <div class="problem-description" id="problemDescription">
                    Î¨∏Ï†ú ÏÑ§Î™ÖÏùÑ Î∂àÎü¨Ïò§Îäî Ï§ë...
                </div>
                
                <div class="sample-section" id="sampleInputSection" style="display: none;">
                    <div class="sample-title">ÏûÖÎ†• ÏòàÏ†ú</div>
                    <div class="sample-content" id="sampleInput"></div>
                </div>
                
                <div class="sample-section" id="sampleOutputSection" style="display: none;">
                    <div class="sample-title">Ï∂úÎ†• ÏòàÏ†ú</div>
                    <div class="sample-content" id="sampleOutput"></div>
                </div>
            </div>
        </div>

        <div class="right-panel">
            <div class="panel-header">ÏΩîÎìú ÏûëÏÑ±</div>
            <div class="code-container">
                <div id="editor-container"></div>
                
                <div class="output-container" id="outputContainer" style="display: none;">
                    <div class="output-header">Ïã§Ìñâ Í≤∞Í≥º</div>
                    <div class="output-content" id="output"></div>
                </div>
                
                <div id="aiLoadingState" class="loading-ai" style="display: none;">
                    <div class="loading-spinner"></div>
                    <span>ü§ñ AIÍ∞Ä ÎãπÏã†Ïùò ÏΩîÎìúÎ•º Î∂ÑÏÑùÌïòÍ≥† ÏûàÏñ¥Ïöî...</span>
                </div>

                <div id="aiFeedbackResult" class="ai-feedback-container" style="display: none;">
                    <div class="ai-feedback-header">
                        <span>ü§ñ AI ÏΩîÎìú Î∂ÑÏÑù Í≤∞Í≥º</span>
                        <span id="creativeBadge" class="creative-badge" style="display: none;">üé® Ï∞ΩÏùòÏ†Å!</span>
                    </div>

                    <div class="score-display" id="scoreDisplay">
                        <span>Ï†êÏàò:</span>
                        <span id="aiScore">0</span>
                        <span>/100</span>
                    </div>

                    <div class="feedback-section">
                        <div class="feedback-section-title">üìù Ï¢ÖÌï© ÌèâÍ∞Ä</div>
                        <div class="feedback-content" id="aiFeedbackText">ÌèâÍ∞ÄÎ•º ÏßÑÌñâÏ§ëÏûÖÎãàÎã§...</div>
                    </div>

                    <div class="feedback-section" id="strengthsSection" style="display: none;">
                        <div class="feedback-section-title">‚ú® ÏûòÌïú Ï†ê</div>
                        <div class="feedback-content">
                            <ul id="strengthsList" class="strengths-list">
                            </ul>
                        </div>
                    </div>

                    <div class="feedback-section" id="improvementsSection" style="display: none;">
                        <div class="feedback-section-title">üöÄ Í∞úÏÑ†Ìï† Ï†ê</div>
                        <div class="feedback-content">
                            <ul id="improvementsList" class="improvements-list">
                            </ul>
                        </div>
                    </div>

                    <div style="font-size: 0.8rem; opacity: 0.8; text-align: right; margin-top: 1rem;">
                        ‚è±Ô∏è ÌèâÍ∞Ä ÏãúÍ∞Ñ: <span id="evaluationTime">Í≥ÑÏÇ∞Ï§ë...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let editor;
        let currentProblem = null;
        let fullSolution = '';
        let hintLevel = 0;

        require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs' } });

        require(['vs/editor/editor.main'], function () {
            editor = monaco.editor.create(document.getElementById('editor-container'), {
                value: '',
                language: 'java',
                theme: 'vs-dark',
                fontSize: 14,
                automaticLayout: true,
                minimap: { enabled: false },
                scrollBeyondLastLine: false,
                wordWrap: 'on'
            });
        });

        function createStarterTemplate(fullCode, category) {
            fullSolution = fullCode || '';
            
            if (category && category.includes('Java')) {
                return fullCode
                    .replace(/(System\.out\.println\([^)]*\);)/g, '// Ïó¨Í∏∞Ïóê Ï∂úÎ†•Î¨∏ÏùÑ ÏûëÏÑ±ÌïòÏÑ∏Ïöî')
                    .replace(/(public\s+static\s+void\s+main[^{]*\{)([\s\S]*?)(\})/g, function(match, start, content, end) {
                        if (content.includes('Ïó¨Í∏∞Ïóê Ï∂úÎ†•Î¨∏ÏùÑ ÏûëÏÑ±ÌïòÏÑ∏Ïöî')) {
                            return start + content + end;
                        }
                        return start + '\n        // Ïó¨Í∏∞Ïóê ÏΩîÎìúÎ•º ÏûëÏÑ±ÌïòÏÑ∏Ïöî\n    ' + end;
                    });
            }
            
            return fullCode || 'public class Main {\n    public static void main(String[] args) {\n        // Ïó¨Í∏∞Ïóê ÏΩîÎìúÎ•º ÏûëÏÑ±ÌïòÏÑ∏Ïöî\n    }\n}';
        }

        function showHint() {
            if (!currentProblem) {
                alert('Î¨∏Ï†úÎ•º Î®ºÏ†Ä Î°úÎìúÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            if (currentProblem.type === 'MULTIPLE_CHOICE' || currentProblem.problemType === 'MULTIPLE_CHOICE') {
                alert('Í∞ùÍ¥ÄÏãù Î¨∏Ï†úÎäî ÌûåÌä∏Î•º Ï†úÍ≥µÌïòÏßÄ ÏïäÏäµÎãàÎã§.');
                return;
            }
            
            if (!fullSolution) {
                alert('ÌûåÌä∏Î•º ÏÇ¨Ïö©Ìï† Ïàò ÏóÜÏäµÎãàÎã§.');
                return;
            }
            
            hintLevel++;
            if (hintLevel > 3) {
                hintLevel = 0;
                editor.setValue(createStarterTemplate(fullSolution, currentProblem?.category));
                document.getElementById('hintLevel').textContent = '0/3';
                return;
            }
            
            let hintCode = '';
            const category = currentProblem?.category;
            
            if (hintLevel === 1) {
                hintCode = addHint1(fullSolution, category);
            } else if (hintLevel === 2) {
                hintCode = addHint2(fullSolution, category);
            } else if (hintLevel === 3) {
                hintCode = fullSolution;
            }
            
            editor.setValue(hintCode);
            document.getElementById('hintLevel').textContent = `${hintLevel}/3`;
        }

        function selectChoice(index) {
            document.querySelectorAll('.choice-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            const choiceElement = document.querySelector(`#choice${index}`).parentElement;
            choiceElement.classList.add('selected');
            
            const radioButton = document.querySelector(`#choice${index}`);
            radioButton.checked = true;
        }

        function submitMultipleChoice() {
            const selectedChoice = document.querySelector('input[name="answer"]:checked');
            
            if (!selectedChoice) {
                alert('ÎãµÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            const selectedIndex = parseInt(selectedChoice.value);
            const correctAnswerLetter = currentProblem.sampleOutput || 'B';
            let correctIndex = 0;
            
            if (correctAnswerLetter === 'A') correctIndex = 0;
            else if (correctAnswerLetter === 'B') correctIndex = 1;  
            else if (correctAnswerLetter === 'C') correctIndex = 2;
            
            const isCorrect = selectedIndex === correctIndex;
            
            const feedbackElement = document.getElementById('aiFeedbackResult');
            const feedbackText = document.getElementById('mcFeedbackText');
            
            if (isCorrect) {
                feedbackElement.style.background = '#27ae60';
                feedbackText.textContent = 'Ï†ïÎãµÏûÖÎãàÎã§! ÏûòÌïòÏÖ®ÏäµÎãàÎã§.';
            } else {
                feedbackElement.style.background = '#e74c3c';
                feedbackText.textContent = `ÌãÄÎ†∏ÏäµÎãàÎã§. Ï†ïÎãµÏùÄ ${correctAnswerLetter}Î≤àÏûÖÎãàÎã§.`;
            }
            
            feedbackElement.style.display = 'block';
        }

        function addHint1(fullCode, category) {
            if (category && category.includes('Java')) {
                return fullCode
                    .replace(/\/\/ Ïó¨Í∏∞Ïóê Ï∂úÎ†•Î¨∏ÏùÑ ÏûëÏÑ±ÌïòÏÑ∏Ïöî/g, '// ÌûåÌä∏: System.out.println("ÎÇ¥Ïö©");')
                    .replace(/\/\/ Ïó¨Í∏∞Ïóê ÏΩîÎìúÎ•º ÏûëÏÑ±ÌïòÏÑ∏Ïöî/g, '// ÌûåÌä∏: Î≥ÄÏàò ÏÑ†Ïñ∏Ïù¥ÎÇò Ïó∞ÏÇ∞ÏùÑ Ìï¥Î≥¥ÏÑ∏Ïöî');
            }
            
            return fullCode;
        }

        function addHint2(fullCode, category) {
            if (category && category.includes('Java')) {
                return fullCode.replace(/\/\/ ÌûåÌä∏: System\.out\.println\("ÎÇ¥Ïö©"\);/g, function(match) {
                    return Math.random() > 0.3 ? 'System.out.println("Hello World");' : match;
                });
            }
            
            return fullCode;
        }

        async function runCode() {
            if (!editor) {
                alert('ÏΩîÎìú ÏóêÎîîÌÑ∞Í∞Ä Ï§ÄÎπÑÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                return;
            }

            const code = editor.getValue();
            const output = document.getElementById('output');
            
            document.getElementById('aiFeedbackResult').style.display = 'none';
            document.getElementById('outputContainer').style.display = 'flex';
            
            output.innerHTML = '<div class="loading">ÏΩîÎìúÎ•º Ïã§ÌñâÌïòÎäî Ï§ë...</div>';

            try {
                setTimeout(() => {
                    if (code.includes('System.out.println')) {
                        const matches = code.match(/System\.out\.println\(([^)]+)\)/g);
                        if (matches) {
                            let outputText = '';
                            matches.forEach(match => {
                                const content = match.match(/System\.out\.println\(([^)]+)\)/)[1];
                                const cleanContent = content.replace(/"/g, '');
                                outputText += cleanContent + '\n';
                            });
                            output.innerHTML = `<div class="success">Ïã§Ìñâ ÏÑ±Í≥µ!</div><pre>${outputText}</pre>`;
                        } else {
                            output.innerHTML = `<div class="success">Ïã§Ìñâ ÏÑ±Í≥µ!</div><pre>Ï∂úÎ†• ÏôÑÎ£å</pre>`;
                        }
                    } else if (code.toLowerCase().includes('print')) {
                        output.innerHTML = `<div class="success">Ïã§Ìñâ ÏÑ±Í≥µ!</div><pre>Í≤∞Í≥ºÍ∞Ä Ï∂úÎ†•ÎêòÏóàÏäµÎãàÎã§.</pre>`;
                    } else {
                        output.innerHTML = `<div class="error">Ïã§Ìñâ Í≤∞Í≥º ÏóÜÏùå</div><pre>Ï∂úÎ†•Î¨∏ÏùÑ Ï∂îÍ∞ÄÌï¥Î≥¥ÏÑ∏Ïöî.</pre>`;
                    }
                }, 500);

            } catch (error) {
                console.error('ÏΩîÎìú Ïã§Ìñâ Ïã§Ìå®:', error);
                output.innerHTML = `<div class="error">Ïã§Ìñâ Ïò§Î•ò</div><pre>ÏΩîÎìúÎ•º ÌôïÏù∏Ìï¥Ï£ºÏÑ∏Ïöî.</pre>`;
            }
        }

        async function submitCode() {
            if (!editor || !currentProblem) {
                alert('Î¨∏Ï†úÍ∞Ä Î°úÎìúÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                return;
            }

            const code = editor.getValue().trim();
            if (!code) {
                alert('ÏΩîÎìúÎ•º ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            showAILoading();
            document.getElementById('outputContainer').style.display = 'none';

            const startTime = Date.now();

            try {
                const authToken = localStorage.getItem('authToken') || localStorage.getItem('jwtToken');
                
                if (!authToken) {
                    alert('Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.');
                    showAIError();
                    return;
                }

                const response = await fetch(`/practice/submit/${currentProblem.problemId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ answer: code })
                });

                const evaluationTime = ((Date.now() - startTime) / 1000).toFixed(1);

                if (!response.ok) {
                    if (response.status === 401) {
                        alert('Ïù∏Ï¶ùÏù¥ ÎßåÎ£åÎêòÏóàÏäµÎãàÎã§. Îã§Ïãú Î°úÍ∑∏Ïù∏Ìï¥Ï£ºÏÑ∏Ïöî.');
                        window.location.href = '/';
                        return;
                    }
                    throw new Error(`HTTP ${response.status}`);
                }

                const result = await response.json();
                showAIFeedback(result, evaluationTime);

            } catch (error) {
                console.error('AI ÌèâÍ∞Ä Ïã§Ìå®:', error);
                
                const fallbackResult = performFallbackEvaluation(code);
                const evaluationTime = ((Date.now() - startTime) / 1000).toFixed(1);
                
                showAIFeedback(fallbackResult, evaluationTime);
            }
        }

        function performFallbackEvaluation(code) {
            let score = 20;
            let strengths = [];
            let improvements = [];
            let isCreative = false;

            if (code.includes('System.out.println') || code.includes('print')) {
                score += 30;
                strengths.push('Ï∂úÎ†•Î¨∏ÏùÑ Ïò¨Î∞îÎ•¥Í≤å ÏÇ¨Ïö©ÌñàÏäµÎãàÎã§');
            }

            if (code.includes('public class') && code.includes('main')) {
                score += 25;
                strengths.push('Java Í∏∞Î≥∏ Íµ¨Ï°∞Î•º Ïù¥Ìï¥ÌïòÍ≥† ÏûàÏäµÎãàÎã§');
            }

            if (code.length > 50) {
                score += 15;
                strengths.push('Ï∂©Î∂ÑÌïú ÏñëÏùò ÏΩîÎìúÎ•º ÏûëÏÑ±ÌñàÏäµÎãàÎã§');
            }

            if (code.includes('//') || code.includes('/*')) {
                score += 10;
                isCreative = true;
                strengths.push('Ï£ºÏÑùÏùÑ ÌôúÏö©Ìïú ÏÑ§Î™ÖÏù¥ Ï¢ãÏäµÎãàÎã§');
            }

            if (score < 60) {
                improvements.push('Í∏∞Î≥∏ Î¨∏Î≤ïÏùÑ Îçî ÌïôÏäµÌï¥Î≥¥ÏÑ∏Ïöî');
                improvements.push('ÏòàÏ†ú ÏΩîÎìúÎ•º Ï∞∏Í≥†Ìï¥Î≥¥ÏÑ∏Ïöî');
            }

            if (!code.includes('System.out.println')) {
                improvements.push('Ï∂úÎ†•Î¨∏ ÏÇ¨Ïö©Î≤ïÏùÑ ÌôïÏù∏Ìï¥Î≥¥ÏÑ∏Ïöî');
            }

            return {
                isCorrect: score >= 60,
                score: Math.min(score, 100),
                feedback: score >= 80 ? 'ÌõåÎ•≠Ìïú ÏΩîÎìúÏûÖÎãàÎã§!' : score >= 60 ? 'Ïûò ÏûëÏÑ±Îêú ÏΩîÎìúÎÑ§Ïöî. Ï°∞Í∏àÎßå Îçî Î∞úÏ†ÑÏãúÏºúÎ≥¥ÏÑ∏Ïöî.' : 'Í∏∞Î≥∏Í∏∞Î•º Îçî Îã§Ï†∏Î≥¥ÏÑ∏Ïöî.',
                strengths: strengths,
                improvements: improvements,
                isCreative: isCreative
            };
        }

        function showAILoading() {
            document.getElementById('aiLoadingState').style.display = 'flex';
            document.getElementById('aiFeedbackResult').style.display = 'none';
        }

        function showAIFeedback(result, evaluationTime) {
            document.getElementById('aiLoadingState').style.display = 'none';
            document.getElementById('aiFeedbackResult').style.display = 'block';

            const score = result.score || 0;
            document.getElementById('aiScore').textContent = score;
            
            const scoreDisplay = document.getElementById('scoreDisplay');
            scoreDisplay.className = 'score-display';
            if (score >= 80) {
                scoreDisplay.classList.add('score-high');
            } else if (score >= 60) {
                scoreDisplay.classList.add('score-medium');
            } else {
                scoreDisplay.classList.add('score-low');
            }

            if (result.isCreative) {
                document.getElementById('creativeBadge').style.display = 'inline-block';
            }

            document.getElementById('aiFeedbackText').textContent = result.feedback || 'ÌèâÍ∞ÄÍ∞Ä ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§.';

            if (result.strengths && result.strengths.length > 0) {
                const strengthsList = document.getElementById('strengthsList');
                strengthsList.innerHTML = '';
                result.strengths.forEach(strength => {
                    const li = document.createElement('li');
                    li.textContent = strength;
                    strengthsList.appendChild(li);
                });
                document.getElementById('strengthsSection').style.display = 'block';
            }

            if (result.improvements && result.improvements.length > 0) {
                const improvementsList = document.getElementById('improvementsList');
                improvementsList.innerHTML = '';
                result.improvements.forEach(improvement => {
                    const li = document.createElement('li');
                    li.textContent = improvement;
                    improvementsList.appendChild(li);
                });
                document.getElementById('improvementsSection').style.display = 'block';
            }

            document.getElementById('evaluationTime').textContent = `${evaluationTime}Ï¥à`;

            const container = document.getElementById('aiFeedbackResult');
            if (score >= 80) {
                container.style.background = '#27ae60';
                container.style.color = '#fff';
            } else if (score >= 60) {
                container.style.background = '#f39c12';
                container.style.color = '#fff';
            } else {
                container.style.background = '#e74c3c';
                container.style.color = '#fff';
            }
        }

        function showAIError() {
            document.getElementById('aiLoadingState').style.display = 'none';
            document.getElementById('aiFeedbackResult').style.display = 'none';
            alert('AI ÌèâÍ∞Ä Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
        }

        async function loadProblem() {
            const pathParts = window.location.pathname.split('/');
            const problemId = pathParts[pathParts.length - 1];

            try {
                const response = await fetch(`/practice/api/problems/${problemId}`);
                
                if (!response.ok) {
                    throw new Error('Î¨∏Ï†úÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                }

                currentProblem = await response.json();
                displayProblem(currentProblem);
                
            } catch (error) {
                console.error('Î¨∏Ï†ú Î°úÎî© Ïã§Ìå®:', error);
                document.getElementById('problemTitle').textContent = 'Ïò§Î•ò Î∞úÏÉù';
                document.getElementById('problemDescription').textContent = error.message;
            }
        }

        function displayProblem(problem) {
            document.getElementById('problemTitle').textContent = problem.title;
            document.getElementById('problemDescription').textContent = problem.description;

            if (problem.sampleInput) {
                document.getElementById('sampleInput').textContent = problem.sampleInput;
                document.getElementById('sampleInputSection').style.display = 'block';
            }

            if (problem.sampleOutput) {
                document.getElementById('sampleOutput').textContent = problem.sampleOutput;
                document.getElementById('sampleOutputSection').style.display = 'block';
            }

            if (problem.solutionTemplate) {
                const starterCode = createStarterTemplate(problem.solutionTemplate, problem.category);
                
                if (editor) {
                    const language = getLanguageFromCategory(problem.category);
                    monaco.editor.setModelLanguage(editor.getModel(), language);
                    editor.setValue(starterCode);
                } else {
                    setTimeout(() => {
                        if (editor) {
                            const language = getLanguageFromCategory(problem.category);
                            monaco.editor.setModelLanguage(editor.getModel(), language);
                            editor.setValue(starterCode);
                        }
                    }, 1000);
                }
            }

            document.title = `${problem.title} - Java Battle Arena`;
        }

        function getLanguageFromCategory(category) {
            if (category === 'HTML Í∏∞Ï¥à') return 'html';
            if (category === 'CSS Í∏∞Ï¥à') return 'css';
            if (category === 'JavaScript Í∏∞Ï¥à') return 'javascript';
            if (category === 'DB/SQL') return 'sql';
            if (category && category.includes('Java')) return 'java';
            return 'java'; 
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadProblem();
        });
    </script>
</body>
</html>