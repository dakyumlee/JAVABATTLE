<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Debug</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.6.1/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
</head>
<body>
    <h1>WebSocket ì—°ê²° í…ŒìŠ¤íŠ¸</h1>
    <div id="status">ì—°ê²° ì¤‘...</div>
    <button onclick="testConnection()">ì—°ê²° í…ŒìŠ¤íŠ¸</button>
    <div id="log"></div>

    <script>
        function log(message) {
            const logDiv = document.getElementById('log');
            logDiv.innerHTML += '<div>' + new Date().toLocaleTimeString() + ': ' + message + '</div>';
        }

        function testConnection() {
            log('WebSocket ì—°ê²° ì‹œë„...');
            
            try {
                const socket = new SockJS('/ws');
                const stompClient = Stomp.over(socket);
                
                stompClient.connect(
                    {}, 
                    function(frame) {
                        log('âœ… WebSocket ì—°ê²° ì„±ê³µ: ' + frame);
                        document.getElementById('status').textContent = 'ì—°ê²°ë¨';
                        
                        stompClient.subscribe('/user/queue/battle', function(message) {
                            log('ğŸ“¨ ë©”ì‹œì§€ ìˆ˜ì‹ : ' + message.body);
                        });
                        
                        // í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ ì „ì†¡
                        stompClient.send('/app/battle/test', {}, JSON.stringify({
                            message: 'test'
                        }));
                        
                    }, 
                    function(error) {
                        log('âŒ WebSocket ì—°ê²° ì‹¤íŒ¨: ' + error);
                        document.getElementById('status').textContent = 'ì—°ê²° ì‹¤íŒ¨';
                    }
                );
            } catch (e) {
                log('ğŸ’¥ ì˜ˆì™¸ ë°œìƒ: ' + e.message);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í…ŒìŠ¤íŠ¸
        window.onload = testConnection;
    </script>
</body>
</html>
